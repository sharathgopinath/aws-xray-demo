AWSTemplateFormatVersion: '2010-09-09'
Transform: "AWS::Serverless-2016-10-31"
Description: aws-xray-demo

Parameters:
  EnvName:
    Type: String
    Description: Name of an environment. 'dev', 'staging', 'prod' and any name.

Resources:
  DDBTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: "upper-case-text"
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "id"
          AttributeType: "S"
      KeySchema:
        -
          AttributeName: "id"
          KeyType: "HASH"

  LambdaFunction:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName:
        Fn::Sub: aws-xray-demo-trigger-${EnvName}
      Description: Takes a string and does a ToUpper and saves in database
      Runtime: dotnetcore3.1
      CodeUri: ./packages/aws-xray-demo
      Handler: aws-xray-demo::aws_xray_demo.Trigger.Function::ToUpper
      MemorySize: 128
      Timeout: 20
      Tracing: Active
      Policies:
        - DynamoDBCrudPolicy:
            TableName: !Ref DDBTable